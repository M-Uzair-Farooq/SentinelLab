"""
Map vulnerabilities to available exploits
"""

from typing import List, Dict

class ExploitMapper:
    """Map vulnerabilities to available exploits"""
    
    # Vulnerability to exploit mapping
    VULN_TO_EXPLOIT = {
        'MS17-010 (EternalBlue)': 'MS17-010 (EternalBlue)',
        'SMBv1 Null Session': 'SMBv1 Null Session',
        'MS08-067 (NetAPI)': 'MS08-067 (NetAPI)',
        'BlueKeep (CVE-2019-0708)': 'BlueKeep',
        'NetBIOS Name Service Overflow': 'NetBIOS_Exploit'
    }
    
    def map_vulnerability_to_exploit(self, vulnerability_name: str) -> str:
        """Map vulnerability name to available exploit"""
        return self.VULN_TO_EXPLOIT.get(vulnerability_name, '')
        
    def get_exploit_requirements(self, exploit_name: str) -> List[str]:
        """Get requirements for an exploit"""
        requirements = {
            'MS17-010 (EternalBlue)': [
                'Target running Windows 7/Server 2008 R2 or earlier',
                'SMBv1 enabled',
                'Port 445 accessible',
                'No MS17-010 patch installed'
            ],
            'MS08-067 (NetAPI)': [
                'Windows 2000/XP/2003/Vista/2008/7',
                'Port 445 accessible',
                'No MS08-067 patch installed'
            ],
            'SMBv1 Null Session': [
                'SMB service running',
                'Null sessions allowed',
                'Port 445 accessible'
            ]
        }
        
        return requirements.get(exploit_name, [
            'Target vulnerable to specific CVE',
            'Network access to vulnerable service'
        ])
        
    def check_prerequisites(self, target_info: Dict, exploit_name: str) -> Dict:
        """Check if prerequisites are met for exploitation"""
        checks = {
            'MS17-010 (EternalBlue)': {
                'os_version': ['Windows 7', 'Windows Server 2008'],
                'port_open': [445],
                'service': ['SMB']
            },
            'MS08-067 (NetAPI)': {
                'os_version': ['Windows 7', 'Windows Vista', 'Windows XP'],
                'port_open': [445],
                'service': ['SMB', 'NetAPI']
            }
        }
        
        exploit_checks = checks.get(exploit_name, {})
        results = {}
        
        for check, requirements in exploit_checks.items():
            if check == 'os_version':
                target_os = target_info.get('os', '')
                results[check] = any(req in target_os for req in requirements)
            elif check == 'port_open':
                open_ports = target_info.get('open_ports', [])
                results[check] = any(port in open_ports for port in requirements)
                
        return results